<VirtualHost *>
  <Directory />
    Order Deny,Allow
    Allow from all
  </Directory>
  ServerAlias *.openfoundry.org
  ServerName webhosting.openfoundry.org
  ErrorLog /dev/null
  RewriteEngine On
  RewriteCond %{SERVER_NAME} ^webhosting.openfoundry.org$
  RewriteRule ^/(.*)$ /usr/local/webhosting/html/$1 [L]

#
# redirectURL
#
  RewriteMap projExtURL txt:/usr/local/webhosting/conf/redirect.txt
  RewriteCond %{SERVER_NAME} ([^.]+).openfoundry.org$
  RewriteCond ${projExtURL:%1} (.+)
  RewriteRule . %1 [R=302,L]

#
# document root for projects
#
#RewriteCond %{SERVER_NAME} ([^.]+).openfoundry.org$
#  RewriteCond %{SERVER_NAME} (((.).)[^.]+).openfoundry.org$
  RewriteCond %{SERVER_NAME} ^(.+).openfoundry.org$
  RewriteCond /usr/upload/%1/webroot -d
  RewriteRule ^/(.*)$ /usr/upload/%1/webroot/$1 [L]

#
# project search
#
RewriteCond %{SERVER_NAME} ([^.]+).openfoundry.org$
RewriteRule ^/(.*)$ http://dev.openfoundry.org/search?query=%1&commit=search
</VirtualHost>
